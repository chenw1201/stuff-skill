<!DOCTYPE html>
<html lang="jp" xmlns:th="http://www.thymeleaf.org">
	<head>
		<!-- Required meta tags always come first -->
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		
		<title>ウィクレソフト・ジャパン　社員スキル情報システム</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css" integrity="sha384-2hfp1SzUoho7/TsGGGDaFdsuuDL0LX2hnUp6VkX3CUQ2K4K+xjboZdsXyp4oUHZj" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js" integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/js/bootstrap.min.js" integrity="sha384-VjEeINv9OSwtWFLAtmc4JCtEJXXBub00gtSnszmspDLCtC0I4z4nqz7rEFbIZLLU" crossorigin="anonymous"></script>
		<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
	</head>
	
	<body>
		<div align="center" style="margin: 10px">
			<h1>ウィクレソフト・ジャパン　社員スキル情報システム</h1>
		</div>
		<hr>
		<div align="center" style="margin: 10px">
			<table id="stuffAll" class="table table-bordered">
				<thead class="thead-inverse">
					<tr>
						<th>#</th>
						<th>名前</th>
						<th>年齢</th>
						<th>性別</th>
						<th>国籍</th>
						<th>経験年数</th>
						<th>単価</th>
						<th>資格</th>
						<th>環境（OS）</th>
						<th>DB</th>
						<th>言語</th>
					</tr>
				</thead>
				<tbody>
					<tr class="openRow" th:each="stuffMeta,iterStat : ${stuffMetas}">
						<th scope="row" th:text="${stuffMeta.id}">1</th>
						<td th:text="${stuffMeta.name}">Mark</td>
						<td th:text="${stuffMeta.age}"></td>
						<td th:text="${stuffMeta.sex}"></td>
						<td th:text="${stuffMeta.nationality}"></td>
						<td th:text="${stuffMeta.experienceYear}"></td>
						<td th:text="${stuffMeta.price}"></td>
						<td th:text="${stuffMeta.license}"></td>
						<td th:text="${stuffMeta.os}"></td>
						<td th:text="${stuffMeta.db}"></td>
						<td th:text="${stuffMeta.developLanguage}"></td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<script type="text/javascript">
			/* Formatting function for row details - modify as you need */
			function stuffDetailInfo( rowId, stuffId ) {
				$.ajax({
					type : "GET",
// 					contentType : "application/json",
					url : "/stuffDetail/" + stuffId,
// 					data : JSON.stringify(data),
					dataType : 'html',
					cache: false,
					timeout : 10000,
					success : function(data) {
						console.log("SUCCESS: ", data);
						$('#' + rowId).html(data);
					},
					error : function(e) {
						console.log("ERROR: ", e);
						$('#' + rowId).html('サーバーとの通信で問題が発生しました。 後でもう一度お試しください。');
					},
					done : function(e) {
						console.log("DONE");
					}
				});
				
			}
			function format ( d ) {
			    // `d` is the original data object for the row
			    return '<table id="' + d + '" cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
			        '<tr>'+
			            '<td>資格 :</td>'+
			            '<td>Loading</td>'+
			        '</tr>'+
			        '<tr>'+
			            '<td>環境(OS) :</td>'+
			            '<td>Loading</td>'+
			        '</tr>'+
			        '<tr>'+
			            '<td>DB :</td>'+
			            '<td>Loading</td>'+
			        '</tr>'+
			        '<tr>'+
			            '<td>言語 :</td>'+
			            '<td>Loading</td>'+
			        '</tr>'+
			    '</table>';
			}

			$(document).ready(function() {
			    var table = $('#stuffAll').DataTable( {
// 			        "ajax": "../ajax/data/objects.txt",
// 			        "columns": [
// 			            {
// 			                "className":      'details-control',
// 			                "orderable":      false,
// 			                "data":           null,
// 			                "defaultContent": ''
// 			            },
// 			            { "data": "name" },
// 			            { "data": "position" },
// 			            { "data": "office" },
// 			            { "data": "salary" }
// 			        ],
// 			        "order": [[1, 'asc']]
			    } );
				$('#stuffAll')
				.removeClass( 'display' )
// 				.addClass('table table-striped table-bordered');
				
			    // Add event listener for opening and closing details
			    $('.openRow').on('click', function () {
			        var tr = $(this).closest('tr');
			        var row = table.row( tr );
			 
			        if ( row.child.isShown() ) {
			            // This row is already open - close it
			            row.child.hide();
			            tr.removeClass('shown');
			        }
			        else {
			            // Open this row
			            var stuffId = row.data()[0];
			            var rowId = "subrow" + stuffId;
			            row.child( format(rowId) ).show();
			            tr.addClass('shown');
			            stuffDetailInfo(rowId, stuffId);
			        }
			    } );
			} );
		</script>
	</body>
</html>